<div class="profile-page">
	@if (isLoading())
	{
		<mat-spinner diameter="40"></mat-spinner>
	}
	@else if (error())
	{
		<mat-card class="error-card">
			<mat-card-content>{{ error() }}</mat-card-content>
		</mat-card>
	}
	@else if (profile(); as p)
	{
		<mat-card>
			<mat-card-header>
				<mat-card-title>{{ p.username }}</mat-card-title>
				@if (p.lastLoginAt)
				{
					<mat-card-subtitle
						>Last login
						{{ p.lastLoginAt | date }}</mat-card-subtitle
					>
				}
			</mat-card-header>

			<mat-card-content>
				<form [formGroup]="profileForm" (ngSubmit)="onSubmit()">
					<mat-form-field appearance="outline">
						<mat-label>Email</mat-label>
						<input matInput formControlName="email" type="email" />
						<mat-error>
							{{ getFieldError("email", "Email") }}
						</mat-error>
					</mat-form-field>

					<mat-form-field appearance="outline">
						<mat-label>Full Name</mat-label>
						<input matInput formControlName="fullName" />
					</mat-form-field>

					<div class="form-actions">
						<button
							mat-raised-button
							color="primary"
							type="submit"
							[disabled]="
								profileForm.invalid ||
								profileForm.pristine ||
								isSaving()
							"
						>
							@if (isSaving())
							{
								<mat-spinner diameter="20"></mat-spinner>
							}
							@else
							{
								Save Changes
							}
						</button>
						<a mat-button routerLink="permissions"
							>Request Permissions</a
						>
					</div>
				</form>
			</mat-card-content>
		</mat-card>
	}
</div>
