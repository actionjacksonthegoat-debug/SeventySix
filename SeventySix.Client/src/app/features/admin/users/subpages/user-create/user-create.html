<div class="user-create-page">
	<!-- Page Header -->
	<header class="page-header">
		<h1 class="mat-headline-5">Create New User</h1>
		<div class="page-actions">
			<button
				mat-stroked-button
				type="button"
				(click)="onCancel()"
				[disabled]="isSaving()"
			>
				<mat-icon>close</mat-icon>
				Cancel
			</button>
		</div>
	</header>

	<!-- Error Alert -->
	@if (saveError())
	{
		<mat-card appearance="outlined" class="alert-card error">
			<mat-card-content>
				<div class="alert-content">
					<mat-icon color="warn">warning</mat-icon>
					<span class="mat-body-1">{{ saveError() }}</span>
				</div>
			</mat-card-content>
		</mat-card>
	}

	<!-- Stepper Content -->
	<div class="stepper-container">
		<mat-stepper #stepper [linear]="true" orientation="horizontal">
			<!-- Step 1: Basic Information -->
			<mat-step [stepControl]="basicInfoForm" label="Basic Information">
				<form [formGroup]="basicInfoForm">
					<mat-card appearance="outlined">
						<mat-card-header>
							<mat-card-title>User Details</mat-card-title>
							<mat-card-subtitle>
								Enter the basic user information
							</mat-card-subtitle>
						</mat-card-header>
						<mat-card-content>
							<!-- Username Field -->
							<mat-form-field
								appearance="outline"
								class="full-width"
							>
								<mat-label>Username</mat-label>
								<input
									matInput
									formControlName="username"
									placeholder="Enter username"
									required
								/>
								<mat-icon matIconPrefix>person</mat-icon>
								@if (
									basicInfoForm
										.get("username")
										?.hasError("required")
								)
								{
									<mat-error>Username is required</mat-error>
								}
								@if (
									basicInfoForm
										.get("username")
										?.hasError("minlength")
								)
								{
									<mat-error>
										Username must be at least 3 characters
									</mat-error>
								}
								@if (
									basicInfoForm
										.get("username")
										?.hasError("maxlength")
								)
								{
									<mat-error>
										Username must not exceed 50 characters
									</mat-error>
								}
								@if (
									basicInfoForm
										.get("username")
										?.hasError("usernameTaken")
								)
								{
									<mat-error>
										Username is already taken
									</mat-error>
								}
							</mat-form-field>

							<!-- Email Field -->
							<mat-form-field
								appearance="outline"
								class="full-width"
							>
								<mat-label>Email</mat-label>
								<input
									matInput
									type="email"
									formControlName="email"
									placeholder="Enter email address"
									required
								/>
								<mat-icon matIconPrefix>email</mat-icon>
								@if (
									basicInfoForm
										.get("email")
										?.hasError("required")
								)
								{
									<mat-error>Email is required</mat-error>
								}
								@if (
									basicInfoForm
										.get("email")
										?.hasError("email")
								)
								{
									<mat-error>Invalid email format</mat-error>
								}
								@if (
									basicInfoForm
										.get("email")
										?.hasError("maxlength")
								)
								{
									<mat-error>
										Email must not exceed 255 characters
									</mat-error>
								}
							</mat-form-field>
						</mat-card-content>
					</mat-card>

					<div class="step-actions">
						<button
							mat-stroked-button
							type="button"
							(click)="saveDraft()"
						>
							<mat-icon>save</mat-icon>
							Save Draft
						</button>
						<div class="flex-1"></div>
						<button
							mat-raised-button
							color="primary"
							matStepperNext
						>
							Next
							<mat-icon>arrow_forward</mat-icon>
						</button>
					</div>
				</form>
			</mat-step>

			<!-- Step 2: Account Details -->
			<mat-step
				[stepControl]="accountDetailsForm"
				label="Account Details"
			>
				<form [formGroup]="accountDetailsForm">
					<mat-card appearance="outlined">
						<mat-card-header>
							<mat-card-title
								>Additional Information</mat-card-title
							>
							<mat-card-subtitle>
								Configure account settings
							</mat-card-subtitle>
						</mat-card-header>
						<mat-card-content>
							<!-- Full Name Field -->
							<mat-form-field
								appearance="outline"
								class="full-width"
							>
								<mat-label>Full Name</mat-label>
								<input
									matInput
									formControlName="fullName"
									placeholder="Enter full name"
								/>
								<mat-icon matIconPrefix>badge</mat-icon>
								@if (
									accountDetailsForm
										.get("fullName")
										?.hasError("maxlength")
								)
								{
									<mat-error>
										Full name must not exceed 100 characters
									</mat-error>
								}
								<mat-hint>Optional</mat-hint>
							</mat-form-field>

							<!-- Active Status -->
							<div class="checkbox-field">
								<mat-checkbox
									formControlName="isActive"
									color="primary"
								>
									Active User
								</mat-checkbox>
								<p class="mat-body-2 field-hint">
									Active users can log in to the system
								</p>
							</div>
						</mat-card-content>
					</mat-card>

					<div class="step-actions">
						<button
							mat-stroked-button
							type="button"
							matStepperPrevious
						>
							<mat-icon>arrow_back</mat-icon>
							Back
						</button>
						<button
							mat-stroked-button
							type="button"
							(click)="saveDraft()"
						>
							<mat-icon>save</mat-icon>
							Save Draft
						</button>
						<div class="flex-1"></div>
						<button
							mat-raised-button
							color="primary"
							matStepperNext
						>
							Next
							<mat-icon>arrow_forward</mat-icon>
						</button>
					</div>
				</form>
			</mat-step>

			<!-- Step 3: Review & Submit -->
			<mat-step label="Review & Submit">
				<mat-card appearance="outlined">
					<mat-card-header>
						<mat-card-title>Review User Information</mat-card-title>
						<mat-card-subtitle>
							Verify all details before creating the user
						</mat-card-subtitle>
					</mat-card-header>
					<mat-card-content>
						<div class="review-grid">
							<div class="review-item">
								<mat-icon class="review-icon">person</mat-icon>
								<div class="review-details">
									<span class="mat-body-2 review-label"
										>Username</span
									>
									<span class="mat-body-1">{{
										formData().username
									}}</span>
								</div>
							</div>
							<div class="review-item">
								<mat-icon class="review-icon">email</mat-icon>
								<div class="review-details">
									<span class="mat-body-2 review-label"
										>Email</span
									>
									<span class="mat-body-1">{{
										formData().email
									}}</span>
								</div>
							</div>
							<div class="review-item">
								<mat-icon class="review-icon">badge</mat-icon>
								<div class="review-details">
									<span class="mat-body-2 review-label"
										>Full Name</span
									>
									<span class="mat-body-1">
										{{
											formData().fullName ||
												"Not provided"
										}}
									</span>
								</div>
							</div>
							<div class="review-item">
								<mat-icon class="review-icon">{{
									formData().isActive
										? "check_circle"
										: "cancel"
								}}</mat-icon>
								<div class="review-details">
									<span class="mat-body-2 review-label"
										>Status</span
									>
									<span class="mat-body-1">
										{{
											formData().isActive
												? "Active"
												: "Inactive"
										}}
									</span>
								</div>
							</div>
						</div>
					</mat-card-content>
				</mat-card>

				<div class="step-actions">
					<button mat-stroked-button type="button" matStepperPrevious>
						<mat-icon>arrow_back</mat-icon>
						Back
					</button>
					<div class="flex-1"></div>
					<button
						mat-raised-button
						color="primary"
						type="button"
						(click)="onSubmit()"
						[disabled]="isSaving()"
					>
						@if (isSaving())
						{
							<mat-spinner diameter="20"></mat-spinner>
						}
						@else
						{
							<ng-container>
								<mat-icon>check</mat-icon>
								Create User
							</ng-container>
						}
					</button>
				</div>
			</mat-step>
		</mat-stepper>
	</div>
</div>
