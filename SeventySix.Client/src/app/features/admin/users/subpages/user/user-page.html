<div class="user-page">
	<!-- Page Header -->
	<header class="page-header">
		<h1 class="mat-headline-5">{{ pageTitle() }}</h1>
		<div class="page-actions">
			<button
				mat-stroked-button
				type="button"
				(click)="onCancel()"
				[disabled]="isSaving()"
			>
				<mat-icon>arrow_back</mat-icon>
				Cancel
			</button>
			<button
				mat-raised-button
				color="primary"
				type="submit"
				(click)="onSubmit()"
				[disabled]="
					isSaving() || userForm.invalid || !hasUnsavedChanges()
				"
			>
				@if (isSaving())
				{
					<mat-spinner diameter="20"></mat-spinner>
				}
				@else
				{
					<ng-container>
						<mat-icon>save</mat-icon>
						Save Changes
					</ng-container>
				}
			</button>
		</div>
	</header>

	<!-- Loading State -->
	@if (isLoading())
	{
		<div class="loading-container">
			<mat-spinner></mat-spinner>
			<p class="mat-body-1">Loading user...</p>
		</div>
	}

	<!-- Error State -->
	@if (error() && !isLoading())
	{
		<div class="error-container">
			<mat-card appearance="outlined" class="error-card">
				<mat-card-content>
					<div class="error-content">
						<mat-icon color="warn" class="error-icon"
							>error</mat-icon
						>
						<p class="mat-body-1">{{ error() }}</p>
						<button
							mat-raised-button
							type="button"
							(click)="onCancel()"
						>
							<mat-icon>arrow_back</mat-icon>
							Back to Users
						</button>
					</div>
				</mat-card-content>
			</mat-card>
		</div>
	}

	<!-- User Form -->
	@if (!isLoading() && !error())
	{
		<main class="page-content">
			<!-- Save Error Alert -->
			@if (saveError())
			{
				<mat-card appearance="outlined" class="alert-card error">
					<mat-card-content>
						<div class="alert-content">
							<mat-icon color="warn">warning</mat-icon>
							<span class="mat-body-1">{{ saveError() }}</span>
						</div>
					</mat-card-content>
				</mat-card>
			}

			<form
				[formGroup]="userForm"
				class="user-form"
				(ngSubmit)="onSubmit()"
			>
				<mat-card appearance="outlined">
					<mat-card-header>
						<mat-card-title>User Information</mat-card-title>
					</mat-card-header>
					<mat-card-content>
						<!-- Username Field -->
						<mat-form-field appearance="outline" class="full-width">
							<mat-label>Username</mat-label>
							<input
								matInput
								formControlName="username"
								placeholder="Enter username"
								autocomplete="username"
								required
							/>
							<mat-icon matIconPrefix>person</mat-icon>
							@if (
								userForm.get("username")?.hasError("required")
							)
							{
								<mat-error>Username is required</mat-error>
							}
							@if (
								userForm.get("username")?.hasError("minlength")
							)
							{
								<mat-error>
									Username must be at least 3 characters
								</mat-error>
							}
							@if (
								userForm.get("username")?.hasError("maxlength")
							)
							{
								<mat-error>
									Username must not exceed 50 characters
								</mat-error>
							}
						</mat-form-field>

						<!-- Email Field -->
						<mat-form-field appearance="outline" class="full-width">
							<mat-label>Email</mat-label>
							<input
								matInput
								type="email"
								formControlName="email"
								placeholder="Enter email address"
								autocomplete="email"
								required
							/>
							<mat-icon matIconPrefix>email</mat-icon>
							@if (userForm.get("email")?.hasError("required"))
							{
								<mat-error>Email is required</mat-error>
							}
							@if (userForm.get("email")?.hasError("email"))
							{
								<mat-error>Invalid email format</mat-error>
							}
							@if (userForm.get("email")?.hasError("maxlength"))
							{
								<mat-error>
									Email must not exceed 255 characters
								</mat-error>
							}
						</mat-form-field>

						<!-- Full Name Field -->
						<mat-form-field appearance="outline" class="full-width">
							<mat-label>Full Name</mat-label>
							<input
								matInput
								formControlName="fullName"
								placeholder="Enter full name"
								autocomplete="name"
							/>
							<mat-icon matIconPrefix>badge</mat-icon>
							@if (
								userForm.get("fullName")?.hasError("maxlength")
							)
							{
								<mat-error>
									Full name must not exceed 100 characters
								</mat-error>
							}
							<mat-hint>Optional</mat-hint>
						</mat-form-field>

						<!-- Active Status Field -->
						<div class="checkbox-field">
							<mat-checkbox
								formControlName="isActive"
								color="primary"
							>
								Active User
							</mat-checkbox>
							<p class="mat-body-2 field-hint">
								Inactive users cannot log in to the system
							</p>
						</div>
					</mat-card-content>
				</mat-card>

				<!-- Audit Information -->
				@if (user())
				{
					<mat-expansion-panel>
						<mat-expansion-panel-header>
							<mat-panel-title>
								<mat-icon>info</mat-icon>
								Audit Information
							</mat-panel-title>
						</mat-expansion-panel-header>

						<div class="audit-info">
							<div class="info-row">
								<strong>Created:</strong>
								<span>{{
									user()!.createDate | date: "medium"
								}}</span>
							</div>
							@if (user()!.createdBy)
							{
								<div class="info-row">
									<strong>Created By:</strong>
									<span>{{ user()!.createdBy }}</span>
								</div>
							}
							@if (user()!.modifyDate)
							{
								<div class="info-row">
									<strong>Last Modified:</strong>
									<span>{{
										user()!.modifyDate | date: "medium"
									}}</span>
								</div>
							}
							@if (user()!.modifiedBy)
							{
								<div class="info-row">
									<strong>Modified By:</strong>
									<span>{{ user()!.modifiedBy }}</span>
								</div>
							}
							@if (user()!.lastLoginAt)
							{
								<div class="info-row">
									<strong>Last Login:</strong>
									<span>{{
										user()!.lastLoginAt | date: "medium"
									}}</span>
								</div>
							}
						</div>
					</mat-expansion-panel>
				}

				<!-- Form Info Card -->
				@if (user())
				{
					<mat-card appearance="outlined" class="info-card">
						<mat-card-header>
							<mat-card-title>Metadata</mat-card-title>
						</mat-card-header>
						<mat-card-content>
							<div class="info-grid">
								<div class="info-item">
									<mat-icon class="info-icon"
										>schedule</mat-icon
									>
									<div class="info-details">
										<span class="mat-body-2 info-label"
											>Created</span
										>
										<span class="mat-body-1">
											{{
												user()!.createDate
													| date: "medium"
											}}
										</span>
									</div>
								</div>
								<div class="info-item">
									<mat-icon class="info-icon"
										>fingerprint</mat-icon
									>
									<div class="info-details">
										<span class="mat-body-2 info-label"
											>User ID</span
										>
										<span class="mat-body-1">{{
											user()!.id
										}}</span>
									</div>
								</div>
							</div>
						</mat-card-content>
					</mat-card>
				}
			</form>
		</main>
	}
</div>
