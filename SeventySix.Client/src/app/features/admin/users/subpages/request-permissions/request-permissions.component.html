<section class="request-permissions-page">
	<header class="page-header">
		<h1>Request Permissions</h1>
	</header>

	@if (isLoading()) {
		<mat-spinner diameter="48"></mat-spinner>
	} @else if (noRolesAvailable()) {
		<mat-card>
			<mat-card-content>
				<p class="info-message">
					There are no additional roles available to request.
					You either already have all roles or have pending requests for them.
				</p>
			</mat-card-content>
		</mat-card>
	} @else {
		<mat-card>
			<mat-card-content>
				<form [formGroup]="form" (ngSubmit)="submit()">
					<h3>Select Roles</h3>
					<div class="roles-list">
						@for (role of availableRoles(); track role.name) {
							<mat-checkbox
								[checked]="isRoleSelected(role.name)"
								(change)="toggleRole(role.name)">
								<strong>{{ role.name }}</strong>
								<span class="role-description">{{ role.description }}</span>
							</mat-checkbox>
						}
					</div>

					<mat-form-field appearance="outline" class="message-field">
						<mat-label>Message (optional)</mat-label>
						<textarea
							matInput
							formControlName="requestMessage"
							rows="3"
							placeholder="Explain why you need these permissions...">
						</textarea>
						<mat-hint>Max 500 characters</mat-hint>
					</mat-form-field>

					<div class="actions">
						<button
							mat-raised-button
							color="primary"
							type="submit"
							[disabled]="!hasSelectedRoles() || isSaving()">
							@if (isSaving()) {
								<mat-spinner diameter="20"></mat-spinner>
							} @else {
								Submit Request
							}
						</button>
					</div>
				</form>
			</mat-card-content>
		</mat-card>
	}
</section>
