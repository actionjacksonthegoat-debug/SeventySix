<div class="log-list-container">
	<!-- Loading State -->
	@if (isLoading())
	{
		<div class="loading-container" role="status" aria-live="polite">
			<mat-spinner diameter="64" aria-label="Loading logs"></mat-spinner>
			<p class="mat-body-1">Loading logs...</p>
		</div>
	}

	<!-- Error State -->
	@else if (error())
	{
		<mat-card class="error-card" role="alert" aria-live="assertive">
			<mat-card-content>
				<div class="error-content">
					<mat-icon color="warn" aria-hidden="true"
						>error_outline</mat-icon
					>
					<div>
						<h3 class="mat-headline-6">Error Loading Logs</h3>
						<p class="mat-body-1">{{ error() }}</p>
					</div>
				</div>
			</mat-card-content>
			<mat-card-actions align="end">
				<button mat-button color="primary" (click)="onRetry()">
					Try Again
				</button>
			</mat-card-actions>
		</mat-card>
	}

	<!-- Data Display -->
	@else
	{
		<!-- Collapsible Advanced Filters -->
		<mat-expansion-panel
			[(expanded)]="filtersExpanded"
			class="filters-expansion-panel"
		>
			<mat-expansion-panel-header>
				<mat-panel-title>
					<mat-icon>tune</mat-icon>
					Advanced Filters
				</mat-panel-title>
				<mat-panel-description>
					Filter by level, date range, and more
				</mat-panel-description>
			</mat-expansion-panel-header>
			<div class="filters-section">
				<app-log-filters (filterChange)="onFilterChange($event)" />
			</div>
		</mat-expansion-panel>

		<!-- Search and Column Customization -->
		<div class="table-header">
			<mat-form-field class="search-field" appearance="outline">
				<mat-label>Search logs</mat-label>
				<input
					matInput
					[(ngModel)]="searchFilter"
					(ngModelChange)="applySearch()"
					placeholder="Search message, source, stack trace..."
					autocomplete="off"
					aria-label="Search logs by message, source, or stack trace"
				/>
				<mat-icon matPrefix aria-hidden="true">search</mat-icon>
				@if (searchFilter())
				{
					<button
						matSuffix
						mat-icon-button
						aria-label="Clear search"
						(click)="clearSearch()"
					>
						<mat-icon aria-hidden="true">close</mat-icon>
					</button>
				}
			</mat-form-field>

			<!-- Column Visibility Menu -->
			<button
				mat-icon-button
				[matMenuTriggerFor]="columnMenu"
				matTooltip="Customize columns"
				aria-label="Customize table columns"
			>
				<mat-icon>view_column</mat-icon>
			</button>
			<mat-menu
				#columnMenu="matMenu"
				aria-label="Column visibility options"
			>
				<div class="column-menu-header" mat-menu-item disabled>
					<strong>Show/Hide Columns</strong>
				</div>
				@for (col of columns(); track col.key)
				{
					@if (col.key !== "select" && col.key !== "actions")
					{
						<button
							mat-menu-item
							(click)="
								toggleColumn(col.key); $event.stopPropagation()
							"
							[attr.aria-label]="
								'Toggle ' + col.label + ' column'
							"
						>
							<mat-checkbox
								[checked]="col.visible"
								(click)="$event.stopPropagation()"
								(change)="toggleColumn(col.key)"
							>
								{{ col.label }}
							</mat-checkbox>
						</button>
					}
				}
			</mat-menu>
		</div>

		<!-- Filter Stats Summary Row -->
		<div class="filter-stats-row">
			<div class="stats-summary" role="status" aria-live="polite">
				<mat-chip>
					<mat-icon aria-hidden="true">description</mat-icon>
					<span aria-label="Total logs"
						>Total: {{ logs()!.totalCount }}</span
					>
				</mat-chip>
				<mat-chip>
					<mat-icon aria-hidden="true">error</mat-icon>
					<span aria-label="Error logs"
						>Errors: {{ errorCount() }}</span
					>
				</mat-chip>
				<mat-chip>
					<mat-icon aria-hidden="true">warning</mat-icon>
					<span aria-label="Warning logs"
						>Warnings: {{ warningCount() }}</span
					>
				</mat-chip>
			</div>
		</div>

		<!-- Log Table -->
		<app-log-table
			[logs]="logs()!.data"
			[totalCount]="logs()!.totalCount"
			[pageIndex]="logs()!.pageNumber - 1"
			[pageSize]="logs()!.pageSize"
			[displayedColumns]="displayedColumns()"
			(logSelected)="onLogSelected($event)"
			(deleteLog)="onDeleteLog($event)"
			(deleteSelected)="onDeleteSelected($event)"
			(pageChange)="onPageChange($event)"
			(pageSizeChange)="onPageSizeChange($event)"
		/>
	}
</div>
