<!-- Page Header -->
<div class="page-header">
	<div class="header-content">
		<div class="header-title">
			<mat-icon class="page-icon">cloud</mat-icon>
			<div>
				<h1 class="mat-headline-4">Weather Forecast</h1>
				<p class="mat-body-2 subtitle">7-day weather outlook</p>
			</div>
		</div>
		<button
			mat-raised-button
			color="primary"
			(click)="refresh()"
			[disabled]="loading()"
		>
			<mat-icon>refresh</mat-icon>
			Refresh
		</button>
	</div>
</div>

<!-- Loading State -->
@if (loading())
{
	<div class="loading-container">
		<mat-spinner diameter="64"></mat-spinner>
		<p class="mat-body-1">Loading weather data...</p>
	</div>
}

<!-- Error State -->
@else if (error())
{
	<mat-card class="error-card">
		<mat-card-content>
			<div class="error-content">
				<mat-icon color="warn">error_outline</mat-icon>
				<div>
					<h3 class="mat-headline-6">Error Loading Data</h3>
					<p class="mat-body-1">{{ error() }}</p>
				</div>
			</div>
		</mat-card-content>
		<mat-card-actions align="end">
			<button mat-button color="primary" (click)="refresh()">
				Try Again
			</button>
		</mat-card-actions>
	</mat-card>
}

<!-- Data Display -->
@else
{
	<!-- Statistics Cards -->
	<section class="stats-section">
		<div class="stats-grid">
			<mat-card class="stat-card">
				<mat-card-content>
					<mat-icon class="stat-icon" color="accent"
						>thermostat</mat-icon
					>
					<div class="stat-value mat-headline-5">
						{{ averageTempC() }}°C
					</div>
					<div class="stat-label mat-body-2">Average Temperature</div>
					<div class="stat-sublabel mat-caption">
						{{ averageTempF() }}°F
					</div>
				</mat-card-content>
			</mat-card>

			<mat-card class="stat-card">
				<mat-card-content>
					<mat-icon class="stat-icon" color="warn"
						>local_fire_department</mat-icon
					>
					@if (hottestDay())
					{
						<div class="stat-value mat-headline-5">
							{{ hottestDay()!.temperatureC }}°C
						</div>
						<div class="stat-label mat-body-2">Hottest Day</div>
						<div class="stat-sublabel mat-caption">
							{{ hottestDay()!.date | date }}
						</div>
					}
				</mat-card-content>
			</mat-card>

			<mat-card class="stat-card">
				<mat-card-content>
					<mat-icon class="stat-icon" color="primary"
						>ac_unit</mat-icon
					>
					@if (coldestDay())
					{
						<div class="stat-value mat-headline-5">
							{{ coldestDay()!.temperatureC }}°C
						</div>
						<div class="stat-label mat-body-2">Coldest Day</div>
						<div class="stat-sublabel mat-caption">
							{{ coldestDay()!.date | date }}
						</div>
					}
				</mat-card-content>
			</mat-card>

			<mat-card class="stat-card">
				<mat-card-content>
					<mat-icon class="stat-icon">calendar_today</mat-icon>
					<div class="stat-value mat-headline-5">
						{{ forecasts().length }}
					</div>
					<div class="stat-label mat-body-2">Days Forecast</div>
					<div class="stat-sublabel mat-caption">Next week</div>
				</mat-card-content>
			</mat-card>
		</div>
	</section>

	<!-- Forecast Table -->
	<section class="table-section">
		<mat-card>
			<mat-card-header>
				<mat-card-title>Detailed Forecast</mat-card-title>
			</mat-card-header>
			<mat-card-content>
				<div class="table-container">
					<table mat-table [dataSource]="forecasts()">
						<!-- Date Column -->
						<ng-container matColumnDef="date">
							<th mat-header-cell *matHeaderCellDef>Date</th>
							<td mat-cell *matCellDef="let forecast">
								<div class="date-cell">
									<mat-icon class="date-icon"
										>calendar_today</mat-icon
									>
									{{ forecast.date | date: "EEE, MMM d" }}
								</div>
							</td>
						</ng-container>

						<!-- Temperature C Column -->
						<ng-container matColumnDef="temperatureC">
							<th mat-header-cell *matHeaderCellDef>
								Temperature (°C)
							</th>
							<td mat-cell *matCellDef="let forecast">
								<mat-chip
									[class]="
										getTemperatureClass(
											forecast.temperatureC
										)
									"
								>
									{{ forecast.temperatureC }}°C
								</mat-chip>
							</td>
						</ng-container>

						<!-- Temperature F Column -->
						<ng-container matColumnDef="temperatureF">
							<th mat-header-cell *matHeaderCellDef>
								Temperature (°F)
							</th>
							<td mat-cell *matCellDef="let forecast">
								@if (forecast.temperatureF)
								{
									<span class="temp-f"
										>{{ forecast.temperatureF }}°F</span
									>
								}
								@else
								{
									<span class="mat-caption">—</span>
								}
							</td>
						</ng-container>

						<!-- Summary Column -->
						<ng-container matColumnDef="summary">
							<th mat-header-cell *matHeaderCellDef>
								Conditions
							</th>
							<td mat-cell *matCellDef="let forecast">
								@if (forecast.summary)
								{
									<mat-chip
										[color]="
											getSummaryColor(forecast.summary)
										"
									>
										{{ forecast.summary }}
									</mat-chip>
								}
								@else
								{
									<span class="mat-caption">No data</span>
								}
							</td>
						</ng-container>

						<!-- Actions Column -->
						<ng-container matColumnDef="actions">
							<th mat-header-cell *matHeaderCellDef>Actions</th>
							<td mat-cell *matCellDef="let forecast">
								<button
									mat-icon-button
									matTooltip="View details"
									aria-label="View forecast details"
								>
									<mat-icon>info</mat-icon>
								</button>
							</td>
						</ng-container>

						<tr
							mat-header-row
							*matHeaderRowDef="displayedColumns"
						></tr>
						<tr
							mat-row
							*matRowDef="let row; columns: displayedColumns"
						></tr>

						<!-- No data row -->
						@if (forecasts().length === 0)
						{
							<tr class="mat-row no-data-row">
								<td
									class="mat-cell"
									[attr.colspan]="displayedColumns.length"
								>
									<div class="no-data">
										<mat-icon>cloud_off</mat-icon>
										<p class="mat-body-1">
											No weather data available
										</p>
									</div>
								</td>
							</tr>
						}
					</table>
				</div>
			</mat-card-content>
		</mat-card>
	</section>
}
