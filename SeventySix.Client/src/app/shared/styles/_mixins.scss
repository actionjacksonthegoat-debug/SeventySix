/**
 * SeventySix - Shared SCSS Mixins
 * Reusable mixins for common UI patterns
 */

@use "variables" as vars;

// ============================================================================
// ELEVATION (Theme-aware shadows)
// ============================================================================
// Use these instead of $elevation-* variables for theme-aware shadows.
// Shadows adapt to light/dark mode automatically via CSS custom properties.
//
// Usage: @include elevation(lg);
// Levels: none, sm, base, md, lg, xl, 2xl
// ============================================================================

/**
 * Theme-aware elevation shadow
 * @param {String} $level
 * Elevation level (none, sm, base, md, lg, xl, 2xl)
 */
@mixin elevation($level: base) {
	@if $level == none {
		box-shadow: none;
	} @else if $level == sm {
		box-shadow:
			0 1px 3px rgba(var(--shadow-color), var(--shadow-opacity)),
			0 1px 2px rgba(var(--shadow-color), var(--shadow-opacity-strong));
	} @else if $level == base or $level == md {
		box-shadow:
			0 3px 6px rgba(var(--shadow-color), var(--shadow-opacity)),
			0 3px 6px rgba(var(--shadow-color), var(--shadow-opacity-strong));
	} @else if $level == lg {
		box-shadow:
			0 10px 20px rgba(var(--shadow-color), var(--shadow-opacity)),
			0 6px 6px rgba(var(--shadow-color), var(--shadow-opacity-strong));
	} @else if $level == xl {
		box-shadow:
			0 14px 28px rgba(var(--shadow-color), var(--shadow-opacity)),
			0 10px 10px rgba(var(--shadow-color), var(--shadow-opacity-strong));
	} @else if $level == 2xl {
		box-shadow:
			0 19px 38px rgba(var(--shadow-color), var(--shadow-opacity)),
			0 15px 12px rgba(var(--shadow-color), var(--shadow-opacity-strong));
	}
}

/**
 * Interactive elevation with hover transition
 * @param {String} $base-level
 * Base elevation level (default: base)
 * @param {String} $hover-level
 * Hover elevation level (default: lg)
 */
@mixin elevation-interactive($base-level: base, $hover-level: lg) {
	@include elevation($base-level);
	transition: box-shadow vars.$transition-duration-base vars.$transition-easing-standard;

	&:hover {
		@include elevation($hover-level);
	}
}

// ============================================================================
// ICON SIZING
// ============================================================================

/**
 * Icon size mixin
 * Sets font-size, width, and height for mat-icon elements
 * @param {Size} $size
 * Icon size (default: $icon-size-base / 24px)
 */
@mixin icon-size($size: vars.$icon-size-base) {
	font-size: $size;
	width: $size;
	height: $size;
}

// ============================================================================
// ICON ALIGNMENT
// ============================================================================

/**
 * Icon alignment mixin
 * Ensures mat-icon elements are vertically centered in any context.
 * Use on mat-icon elements or containers with icons.
 *
 * @example
 *   mat-icon {
 *     @include icon-aligned();
 *   }
 */
@mixin icon-aligned() {
	display: inline-flex;
	align-items: center;
	justify-content: center;
	vertical-align: middle;
	line-height: 1;
	flex-shrink: 0;
}

/**
 * Icon with text alignment mixin
 * For buttons and containers with icon + text.
 * Apply to the container element (button, span, div).
 *
 * @param {Size} $gap
 * Gap between icon and text (default: $spacing-sm / 8px)
 *
 * @example
 *   .button-with-icon {
 *     @include icon-with-text();
 *   }
 */
@mixin icon-with-text($gap: vars.$spacing-sm) {
	display: inline-flex;
	align-items: center;
	gap: $gap;

	mat-icon {
		@include icon-aligned();
	}
}

/**
 * Sized and aligned icon mixin
 * Combines sizing and alignment in one mixin for convenience.
 *
 * @param {Size} $size
 * Icon size (default: $icon-size-base / 24px)
 *
 * @example
 *   .large-icon {
 *     @include icon-sized-aligned(vars.$icon-size-lg);
 *   }
 */
@mixin icon-sized-aligned($size: vars.$icon-size-base) {
	@include icon-size($size);
	@include icon-aligned();
}

// ============================================================================
// FULL-HEIGHT PAGE LAYOUT
// ============================================================================

/**
 * Full-height page layout mixin
 * Use on :host of page components that should fill available viewport height.
 * Works with the app layout's flexbox structure.
 *
 * @example
 *   :host {
 *     @include full-height-page();
 *   }
 */
@mixin full-height-page() {
	display: flex;
	flex-direction: column;
	height: 100%;
	min-height: 0;

	> .page-content,
	> .content,
	> main {
		flex: 1 1 auto;
		min-height: 0;
		overflow-y: auto;
	}
}

/**
 * Scrollable content container mixin
 * For containers within pages that need their own scroll context.
 *
 * @param {Size} $max-height
 * Optional max-height constraint (default: none)
 *
 * @example
 *   .scrollable-panel {
 *     @include scrollable-content();
 *   }
 */
@mixin scrollable-content($max-height: none) {
	flex: 1 1 auto;
	min-height: 0;
	overflow-y: auto;

	@if $max-height != none {
		max-height: $max-height;
	}
}

/**
 * Flex fill column mixin
 * Makes an element participate in a flex column layout chain, filling available height.
 * Used by data-table pages to propagate the flex chain from the app shell
 * down to the cdk-virtual-scroll-viewport.
 *
 * @example
 *   :host {
 *     @include flex-fill-column();
 *   }
 */
@mixin flex-fill-column() {
	display: flex;
	flex-direction: column;
	flex: 1;
	min-height: 0;
}

// ============================================================================
// FEATURE PLACEHOLDER CARD
// ============================================================================

/**
 * Feature placeholder container layout
 * Base container styles for placeholder/coming-soon feature pages
 */
@mixin feature-placeholder-container() {
	padding: vars.$spacing-xl;
	display: flex;
	justify-content: center;
	align-items: flex-start;
	min-height: calc(100vh - vars.$header-height);
}

/**
 * Feature placeholder card styles
 * Card styling for placeholder pages
 * @param {Color} $bg
 * Card background color
 * @param {Color} $text
 * Card text color
 */
@mixin feature-placeholder-card-style(
	$bg: var(--mat-sys-primary-container),
	$text: var(--mat-sys-on-primary-container)
) {
	max-width: vars.$container-width-sm;
	width: 100%;
	background-color: $bg;
	color: $text;
}

/**
 * Feature placeholder icon styles
 * Icon styling for placeholder pages
 * @param {Color} $color
 * Icon color
 */
@mixin feature-placeholder-icon($color: var(--mat-sys-primary)) {
	@include icon-size(vars.$icon-size-xl);
	margin-bottom: vars.$spacing-lg;
	color: $color;
}

// ============================================================================
// DIALOG/MODAL RESPONSIVE SECTIONS
// ============================================================================

/**
 * Responsive dialog section padding
 * Automatically adjusts padding based on breakpoints
 * @param {Size} $desktop
 * Desktop padding (default: $spacing-xl)
 * @param {Size} $tablet
 * Tablet padding (default: $spacing-lg)
 * @param {Size} $mobile
 * Mobile padding (default: $spacing-md)
 */
@mixin dialog-section-responsive(
	$desktop: vars.$spacing-xl,
	$tablet: vars.$spacing-lg,
	$mobile: vars.$spacing-md
) {
	padding: $desktop;

	@media #{vars.$breakpoint-tablet} {
		padding: $tablet;
	}

	@media #{vars.$breakpoint-mobile} {
		padding: $mobile;
	}
}

/**
 * Responsive dialog header
 * Adjusts layout and sizing for mobile devices
 * @param {Size} $icon-size
 * Icon size (default: $icon-size-sm)
 */
@mixin dialog-header-responsive($icon-size: vars.$icon-size-sm) {
	@media #{vars.$breakpoint-tablet} {
		padding: vars.$spacing-md vars.$spacing-lg;

		.header-content {
			flex-direction: column;
			align-items: flex-start;
			gap: vars.$spacing-xs;

			mat-icon {
				font-size: $icon-size;
				width: $icon-size;
				height: $icon-size;
			}
		}
	}

	@media #{vars.$breakpoint-mobile} {
		padding: vars.$spacing-sm vars.$spacing-md;
	}
}

/**
 * Code/pre block with scrollbar
 * Common pattern for stack traces, JSON, etc.
 * @param {Size} $max-height
 * Maximum height before scrolling (default: 18.75rem)
 * @param {Size} $padding
 * Internal padding (default: $spacing-lg)
 * @param {Size} $border-radius
 * Border radius (default: $border-radius-sm)
 * @param {Size} $font-size
 * Font size (default: $font-size-xs)
 */
@mixin code-block-scrollable(
	$max-height: 18.75rem,
	$padding: vars.$spacing-lg,
	$border-radius: vars.$border-radius-sm,
	$font-size: vars.$font-size-xs
) {
	background-color: var(--mat-table-background-color);
	padding: $padding;
	border-radius: $border-radius;
	max-height: $max-height;
	overflow-y: auto;

	// Custom scrollbar
	&::-webkit-scrollbar {
		width: 0.5rem;
		height: 0.5rem;
	}

	&::-webkit-scrollbar-track {
		background: var(--mat-sys-surface-variant);
		border-radius: vars.$border-radius-sm;
	}

	&::-webkit-scrollbar-thumb {
		background: var(--mat-sys-outline);
		border-radius: vars.$border-radius-sm;

		&:hover {
			background: var(--mat-sys-on-surface-variant);
		}
	}

	pre {
		margin: 0;
		font-family: "Roboto Mono", "Courier New", monospace;
		font-size: $font-size;
		line-height: 1.4;
		white-space: pre-wrap;
		word-break: break-word;
	}
}

/**
 * Info grid layout (key-value pairs)
 * Responsive grid for displaying metadata
 * @param {Size} $gap
 * Gap between grid items (default: $spacing-lg)
 * @param {Size} $min-width
 * Minimum column width (default: 12.5rem)
 */
@mixin info-grid-responsive($gap: vars.$spacing-lg, $min-width: 12.5rem) {
	display: grid;
	grid-template-columns: repeat(auto-fit, minmax($min-width, 1fr));
	gap: $gap;

	.info-item {
		display: flex;
		flex-direction: column;
		gap: vars.$spacing-xs;

		.info-label {
			font-size: vars.$font-size-xs;
			font-weight: 500;
			color: var(--mat-dialog-supporting-text-color);
			text-transform: uppercase;
			letter-spacing: 0.05em;
		}

		.info-value {
			font-size: vars.$font-size-sm;
			color: var(--mat-dialog-headline-color);
			word-break: break-word;
		}
	}

	@media #{vars.$breakpoint-tablet} {
		grid-template-columns: 1fr;
		gap: vars.$spacing-md;
	}
}

// ============================================================================
// LEVEL/SEVERITY COLOR CLASSES
// ============================================================================

@mixin log-level-colors() {
	.level-verbose {
		color: var(--color-log-verbose);
	}

	.level-debug {
		color: var(--color-log-debug);
	}

	.level-info {
		color: var(--color-log-info);
	}

	.level-warning {
		color: var(--color-log-warning);
	}

	.level-error {
		color: var(--color-log-error);
	}

	.level-fatal {
		color: var(--color-log-fatal);
	}
}

@mixin log-level-chip() {
	display: inline-block;
	padding: vars.$spacing-xs vars.$spacing-sm;
	border-radius: vars.$border-radius-chip;
	font-size: vars.$font-size-xs;
	font-weight: vars.$font-weight-medium;
	text-transform: uppercase;

	&.level-verbose {
		background-color: var(--color-log-verbose-surface);
		color: var(--color-log-verbose);
	}

	&.level-debug {
		background-color: var(--color-log-debug-surface);
		color: var(--color-log-debug);
	}

	&.level-info {
		background-color: var(--color-log-info-surface);
		color: var(--color-log-info);
	}

	&.level-warning {
		background-color: var(--color-log-warning-surface);
		color: var(--color-log-warning);
	}

	&.level-error {
		background-color: var(--color-log-error-surface);
		color: var(--color-log-error);
	}

	&.level-fatal {
		background-color: var(--color-log-fatal-surface);
		color: var(--color-log-fatal);
	}
}

@mixin empty-state(
	$icon-size: vars.$icon-size-xl,
	$padding: vars.$spacing-3xl vars.$spacing-lg
) {
	text-align: center;
	padding: $padding;
	color: var(--mat-table-row-item-label-text-color);

	mat-icon {
		@include icon-size($icon-size);
		opacity: 0.3;
	}

	p {
		margin: vars.$spacing-sm 0 0 0;
		font-size: vars.$font-size-base;
		opacity: 0.6;
	}
}

// ============================================================================
// PAGE LAYOUT PATTERNS
// ============================================================================
@mixin page-header() {
	.page-header {
		margin-bottom: vars.$spacing-xl;

		@media (max-width: vars.$breakpoint-xs-max) {
			margin-bottom: vars.$spacing-lg;
		}
	}

	.header-content {
		display: flex;
		justify-content: space-between;
		align-items: center;
		flex-wrap: wrap;
		gap: vars.$spacing-md;
	}

	.header-actions {
		display: flex;
		gap: vars.$spacing-sm;

		@media (max-width: vars.$breakpoint-xs-max) {
			width: 100%;

			button {
				flex: 1;
			}
		}
	}

	.header-title {
		display: flex;
		align-items: center;
		gap: vars.$spacing-md;

		.page-icon {
			font-size: vars.$avatar-size-md;
			width: vars.$avatar-size-md;
			height: vars.$avatar-size-md;
			color: var(--mat-primary-default);

			@media (max-width: vars.$breakpoint-xs-max) {
				font-size: vars.$icon-size-xl;
				width: vars.$icon-size-xl;
				height: vars.$icon-size-xl;
			}
		}

		h1 {
			margin: 0;
			font-weight: vars.$font-weight-medium;
		}

		.subtitle {
			margin: vars.$spacing-xs 0 0;
			opacity: 0.7;
		}
	}
}

/**
 * Loading state container
 * Centered flex layout for loading spinners and messages
 * @param {Size} $padding
 * Container padding (default: $spacing-xl)
 * @param {Size} $gap
 * Gap between elements (default: $spacing-lg)
 */
@mixin loading-state($padding: vars.$spacing-xl, $gap: vars.$spacing-lg) {
	display: flex;
	flex-direction: column;
	align-items: center;
	justify-content: center;
	padding: $padding;
	gap: $gap;

	p {
		margin: 0;
	}
}

/**
 * Error state container
 * Centered layout for error messages with optional max-width
 * @param {Size} $padding
 * Container padding (default: $spacing-2xl)
 * @param {Size} $max-width
 * Max width of error card (default: $toast-max-width)
 */
@mixin error-state(
	$padding: vars.$spacing-2xl,
	$max-width: vars.$toast-max-width
) {
	display: flex;
	align-items: center;
	justify-content: center;
	padding: $padding;

	.error-card {
		max-width: $max-width;
	}

	.error-content {
		display: flex;
		flex-direction: column;
		align-items: center;
		text-align: center;
		gap: vars.$spacing-lg;

		.error-icon {
			font-size: vars.$icon-size-xl;
			width: vars.$icon-size-xl;
			height: vars.$icon-size-xl;
		}

		p {
			margin: 0;
		}
	}
}

/**
 * CLS-safe loading overlay pattern
 * Positions loading spinner as absolute overlay without removing content from DOM
 * Prevents layout shift by keeping container dimensions stable during load
 * @param {Number} $z-index
 * Overlay z-index (default: 10)
 * @example
 *   .container {
 *     @include cls-loading-overlay();
 *   }
 */
@mixin cls-loading-overlay($z-index: 10) {
	position: relative;

	.loading-overlay {
		position: absolute;
		inset: 0;
		display: flex;
		align-items: center;
		justify-content: center;
		background-color: rgba(var(--mat-sys-surface-rgb), 0.8);
		z-index: $z-index;
		border-radius: vars.$border-radius-base;
	}
}

/**
 * Alert card pattern
 * Used for displaying inline alerts/warnings
 * @param {Size} $margin-bottom
 * Bottom margin (default: $spacing-xl)
 */
@mixin alert-card($margin-bottom: vars.$spacing-xl) {
	margin-bottom: $margin-bottom;

	&.error {
		border-color: rgb(var(--mat-warn-rgb));
	}

	.alert-content {
		display: flex;
		align-items: center;
		gap: vars.$spacing-md;

		mat-icon {
			flex-shrink: 0;
		}

		span {
			flex: 1;
		}
	}
}

/**
 * Form card content layout
 * Standard vertical layout for form fields inside cards
 */
@mixin form-card-content() {
	display: flex;
	flex-direction: column;
	gap: vars.$spacing-lg;
	padding-top: vars.$spacing-lg;
}

/**
 * Info/Review grid layout
 * Used for displaying key-value pairs in a responsive grid
 * @param {Size} $min-column-width
 * Minimum column width (default: 12.5rem / 200px)
 * @param {Size} $gap
 * Gap between items (default: $spacing-xl)
 */
@mixin info-review-grid($min-column-width: 12.5rem, $gap: vars.$spacing-xl) {
	display: grid;
	grid-template-columns: repeat(auto-fit, minmax($min-column-width, 1fr));
	gap: $gap;
	padding-top: vars.$spacing-lg;

	.info-item,
	.review-item {
		display: flex;
		align-items: flex-start;
		gap: vars.$spacing-md;

		.info-icon,
		.review-icon {
			color: rgba(var(--mat-primary-rgb), 0.7);
			flex-shrink: 0;
		}

		.info-details,
		.review-details {
			display: flex;
			flex-direction: column;
			gap: vars.$spacing-xs;

			.info-label,
			.review-label {
				color: rgba(var(--mat-outline-rgb), 0.6);
				font-weight: vars.$font-weight-medium;
			}
		}
	}

	@media #{vars.$breakpoint-mobile} {
		grid-template-columns: 1fr;
	}
}

// ============================================================================
// FULL PAGE LAYOUTS
// ============================================================================

/**
 * Error page layout
 * Full-page centered error layout with card
 * Used by not-found, server-error, and other error pages
 * @param {Size} $max-width
 * Max width of error container (default: $container-width-sm)
 * @param {Size} $content-gap
 * Gap between content elements (default: $spacing-xl)
 */
@mixin error-page-layout(
	$max-width: vars.$container-width-sm,
	$content-gap: vars.$spacing-xl
) {
	.error-page {
		display: flex;
		align-items: center;
		justify-content: center;
		min-height: 100vh;
		padding: vars.$spacing-2xl;

		.error-container {
			width: 100%;
			max-width: $max-width;

			.error-card {
				mat-card-content {
					padding: vars.$spacing-3xl vars.$spacing-2xl;
				}

				.error-content {
					display: flex;
					flex-direction: column;
					align-items: center;
					text-align: center;
					gap: $content-gap;

					.error-icon {
						font-size: vars.$icon-size-4xl;
						width: vars.$icon-size-4xl;
						height: vars.$icon-size-4xl;
					}

					h1 {
						margin: 0;
					}

					p {
						margin: 0;
						max-width: vars.$container-width-xs;
					}

					.error-actions {
						display: flex;
						gap: vars.$spacing-lg;
						flex-wrap: wrap;
						justify-content: center;
						margin-top: vars.$spacing-lg;
					}
				}
			}
		}
	}

	@media #{vars.$breakpoint-mobile} {
		.error-page {
			padding: vars.$spacing-lg;

			.error-container {
				.error-card {
					mat-card-content {
						padding: vars.$spacing-2xl vars.$spacing-lg;
					}

					.error-content {
						.error-icon {
							font-size: vars.$icon-size-3xl;
							width: vars.$icon-size-3xl;
							height: vars.$icon-size-3xl;
						}

						.error-actions {
							flex-direction: column;
							width: 100%;

							button {
								width: 100%;
							}
						}
					}
				}
			}
		}
	}
}

// ============================================================================
// LANDING PAGE MIXINS
// ============================================================================

/// Creates a CSS parallax scroll container with perspective.
/// Must be applied to the outermost scrollable element.
@mixin parallax-scroll-container() {
	height: 100%;
	overflow-x: hidden;
	overflow-y: auto;
	perspective: vars.$parallax-perspective;
	perspective-origin: center center;

	@media (max-width: vars.$parallax-disable-below) {
		perspective: none;
	}

	@media (prefers-reduced-motion: reduce) {
		perspective: none;
	}
}

/// Creates a parallax depth layer using translateZ + scale compensation.
/// @param {Length} $depth - The Z-axis depth value (negative = farther away).
@mixin parallax-layer($depth) {
	$scale: calc(1 + (#{$depth * -1} / #{vars.$parallax-perspective}));

	transform: translateZ($depth) scale($scale);
	transform-origin: center center;

	@media (max-width: vars.$parallax-disable-below) {
		transform: none;
	}

	@media (prefers-reduced-motion: reduce) {
		transform: none;
	}
}

/// Glassmorphism card effect using theme-aware custom properties.
@mixin glassmorphism() {
	background: var(--landing-glass-bg);
	backdrop-filter: saturate(var(--landing-glass-saturate)) blur(20px);
	border: 1px solid var(--landing-glass-border);
	border-radius: vars.$border-radius-lg;
}

/// Frosted glass pill behind text for readability over image backgrounds.
/// Apply to inline text elements (headings, paragraphs) sitting on images.
/// Uses ::before pseudo â€” avoid on elements that already use ::before.
@mixin text-frosted-glass($v-pad: vars.$spacing-xs, $h-pad: vars.$spacing-md, $blur: 16px) {
	position: relative;
	isolation: isolate;
	display: inline-block;

	&::before {
		content: "";
		position: absolute;
		inset: calc(-1 * #{$v-pad}) calc(-1 * #{$h-pad});
		background: var(--landing-glass-bg);
		backdrop-filter: blur($blur) saturate(var(--landing-glass-saturate));
		border-radius: vars.$border-radius-md;
		z-index: -1;
		mask-image: radial-gradient(
			ellipse at center,
			black 15%,
			transparent 80%
		);
	}
}

/// Gradient mesh background for sections.
@mixin gradient-mesh-background() {
	background:
		radial-gradient(ellipse at 20% 50%, color-mix(in srgb, var(--landing-glow-color) 50%, transparent) 0%, transparent 50%),
		radial-gradient(ellipse at 80% 20%, color-mix(in srgb, var(--landing-floating-shape-color) 50%, transparent) 0%, transparent 40%),
		var(--landing-section-bg);
	background-size: 200% 200%;
	animation: gradient-shift vars.$animation-duration-gradient ease infinite;
}

/// Hidden state for scroll-reveal animation (before intersection).
@mixin scroll-reveal-hidden() {
	opacity: 0;
	transform: translateY(2rem);
	transition:
		opacity vars.$animation-duration-reveal vars.$transition-easing-standard,
		transform vars.$animation-duration-reveal vars.$transition-easing-standard;
}

/// Visible state for scroll-reveal animation (after intersection).
@mixin scroll-reveal-visible() {
	opacity: 1;
	transform: translateY(0);
}

/// Neon glow text effect using theme-aware custom properties.
@mixin neon-glow() {
	text-shadow: var(--landing-text-glow);
}

/// Dot grid pattern overlay for section backgrounds.
@mixin grid-dot-pattern() {
	background-image: radial-gradient(
		circle,
		var(--landing-glow-color) 1px,
		transparent 1px
	);
	background-size: 2rem 2rem;
	opacity: 0.04;
}

/// Section separator with themed glow line.
@mixin section-separator() {
	height: 1px;
	background: linear-gradient(
		90deg,
		transparent 0%,
		var(--landing-divider-glow) 50%,
		transparent 100%
	);
}

/// Grain overlay using theme-controlled opacity.
@mixin landing-grain-overlay() {
	&::before {
		content: '';
		position: absolute;
		inset: 0;
		background-image: url('/images/landing-page/dark-grid-texture.webp');
		background-size: 200px 200px;
		opacity: var(--landing-grain-opacity);
		pointer-events: none;
		z-index: 1;
	}
}

/// Scanline overlay using repeating gradient.
@mixin landing-scanline-overlay() {
	&::after {
		content: '';
		position: absolute;
		inset: 0;
		background: repeating-linear-gradient(
			0deg,
			transparent,
			transparent 2px,
			rgb(0 0 0 / var(--landing-scanline-opacity)) 2px,
			rgb(0 0 0 / var(--landing-scanline-opacity)) 4px
		);
		pointer-events: none;
		z-index: 1;
	}
}
