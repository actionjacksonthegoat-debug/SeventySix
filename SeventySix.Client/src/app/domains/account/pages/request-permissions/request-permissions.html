<app-page-header title="Request Permissions" icon="lock_open" />

<div class="request-permissions-page">
	<mat-card>
		<mat-card-header>
			<mat-card-title>Request Permissions</mat-card-title>
			<mat-card-subtitle>Select roles you need access to</mat-card-subtitle>
		</mat-card-header>

		<mat-card-content>
			@if (isLoading()) {
			<div class="skeleton-list">
				@for (index of [1, 2, 3]; track index) {
				<div class="skeleton-checkbox-row">
					<ngx-skeleton-loader [theme]="skeletonCheckbox" />
					<div class="skeleton-text-block">
						<ngx-skeleton-loader [theme]="skeletonTextShort" />
						<ngx-skeleton-loader [theme]="skeletonTextMedium" />
					</div>
				</div>
				}
			</div>
			} @else {
			<div class="roles-list" data-testid="role-checkboxes-list">
				@for (role of availableRoles(); track role.name) {
				<mat-checkbox
					[checked]="selectedRoles().has(role.name)"
					(change)="toggleRole(role.name)">
					<span class="role-label">
						<strong class="role-name">{{ role.name }}</strong>
						<span class="role-description">{{ role.description }}</span>
					</span>
				</mat-checkbox>
				} @empty {
				<p class="no-roles" data-testid="no-roles-message">No additional roles available</p>
				}
			</div>

			<form
				[formGroup]="requestForm"
				(ngSubmit)="onSubmit()">
				<mat-form-field appearance="outline" subscriptSizing="dynamic">
					<mat-label>Reason for request (optional)</mat-label>
					<textarea
						matInput
						formControlName="requestMessage"
						rows="3"></textarea>
				</mat-form-field>

				<div class="form-actions">
					<button
						mat-stroked-button
						color="primary"
						data-testid="request-permissions-submit"
						type="submit"
						[disabled]="
								selectedRoles().size === 0 || isSubmitting()
							">
						@if (isSubmitting()) {
						<mat-spinner diameter="20" aria-label="Submitting"></mat-spinner>
						} @else { Submit Request }
					</button>
				</div>
			</form>
			}
		</mat-card-content>
	</mat-card>
</div>
