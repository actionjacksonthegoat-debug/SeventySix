<div
	class="api-statistics-table"
	role="region"
	aria-label="Third-party API statistics">
	@if (isLoading()) {
	<mat-card>
		<mat-card-header>
			<mat-card-title>Third-Party API Statistics</mat-card-title>
		</mat-card-header>
		<mat-card-content>
			<div class="skeleton-table">
				@for (row of [1, 2, 3]; track row) {
				<div class="skeleton-table-row">
					<ngx-skeleton-loader [theme]="skeletonTableCell" />
					<ngx-skeleton-loader [theme]="skeletonTableCell" />
					<ngx-skeleton-loader [theme]="skeletonTableCell" />
				</div>
				}
			</div>
		</mat-card-content>
	</mat-card>
	} @else if (error()) {
		<div
			class="error-container"
			role="alert"
			aria-live="assertive">
			<mat-icon
				color="warn"
				aria-hidden="true">error</mat-icon>
			<p>{{ error() }}</p>
			<button
				mat-stroked-button
				color="primary"
				(click)="onRefresh()"
				aria-label="Retry loading API statistics">
				<mat-icon aria-hidden="true">refresh</mat-icon>
				Retry
			</button>
		</div>
	} @else {
		<mat-card>
			<mat-card-header>
				<mat-card-title>Third-Party API Statistics</mat-card-title>
				<button
					mat-icon-button
					(click)="onRefresh()"
					aria-label="Refresh API statistics">
					<mat-icon aria-hidden="true">refresh</mat-icon>
				</button>
			</mat-card-header>
			<mat-card-content>
				@if (dataSource().data.length === 0) {
					<div
						class="no-data"
						role="status">
						<mat-icon aria-hidden="true">api</mat-icon>
						<p>No API data available</p>
					</div>
				} @else {
					<div class="table-container">
						<table
							mat-table
							[dataSource]="dataSource()"
							class="api-table"
							aria-label="API statistics table">
							<!-- API Name Column -->
							<ng-container matColumnDef="apiName">
								<th
									mat-header-cell
									*matHeaderCellDef>
									API Name
								</th>
								<td
									mat-cell
									*matCellDef="let element">
									<div class="api-name-cell">
										<mat-icon aria-hidden="true">api</mat-icon>
										<div>
											<div class="api-name">
												{{ element.apiName }}
											</div>
											<div class="api-url">
												{{ element.baseUrl }}
											</div>
										</div>
									</div>
								</td>
							</ng-container>

							<!-- Call Count Column -->
							<ng-container matColumnDef="callCount">
								<th
									mat-header-cell
									*matHeaderCellDef>
									Calls Today
								</th>
								<td
									mat-cell
									*matCellDef="let element">
									{{ element.callCount }}
								</td>
							</ng-container>

							<!-- Last Called Column -->
							<ng-container matColumnDef="lastCalledAt">
								<th
									mat-header-cell
									*matHeaderCellDef>
									Last Called
								</th>
								<td
									mat-cell
									*matCellDef="let element">
									{{ element.formattedLastCalled }}
								</td>
							</ng-container>

							<tr
								mat-header-row
								*matHeaderRowDef="displayedColumns()">
							</tr>
							<tr
								mat-row
								*matRowDef="
									let row;
									columns: displayedColumns()
								">
							</tr>
						</table>
					</div>
				}
			</mat-card-content>
		</mat-card>
	}
</div>
