<div class="login-container">
	<div class="login-card">
		<h1>Sign In</h1>

		@if (inactivityBannerVisible())
		{
			<div class="inactivity-banner"
				role="alert"
				aria-live="assertive">
				<mat-icon aria-hidden="true">
					timer_off
				</mat-icon>
				<span>
					You have been logged out due to inactivity. Please sign in again.
				</span>
			</div>
		}

		@if (featureFlags.oAuthEnabled()) {
		<!-- OAuth Providers -->
		<div class="oauth-buttons">
			@for (provider of oauthProviders; track provider.id) {
				<button
					type="button"
					class="oauth-button"
					data-testid="oauth-button"
					mat-stroked-button
					[style.--oauth-color]="provider.color"
					[disabled]="isLoading() || isOAuthInProgress()"
					(click)="onOAuthLogin(provider.id)"
					[attr.aria-label]="'Continue with ' + provider.displayName"
					[attr.aria-busy]="isOAuthInProgress()">
					<mat-icon
						class="oauth-icon"
						[svgIcon]="provider.icon"
						aria-hidden="true" />
					Continue with {{ provider.displayName }}
				</button>
			}
		</div>

		<div class="divider"
			data-testid="divider">
			<span>or</span>
		</div>
		}

		<!-- Local Login Form -->
		<form
			[formGroup]="loginForm"
			(ngSubmit)="onLocalLogin()"
			class="login-form">
			<mat-form-field appearance="outline">
				<mat-label>Username or Email</mat-label>
				<input
					matInput
					id="usernameOrEmail"
					type="text"
					formControlName="usernameOrEmail"
					autocomplete="username"
					required
					aria-required="true"
					[attr.aria-invalid]="
						loginForm.get('usernameOrEmail')?.invalid &&
						loginForm.get('usernameOrEmail')?.touched
					"
				/>
				@if (usernameOrEmailError()) {
				<mat-error>
					{{ usernameOrEmailError() }}
				</mat-error>
				}
			</mat-form-field>

			<mat-form-field appearance="outline">
				<mat-label>Password</mat-label>
				<input
					matInput
					id="password"
					type="password"
					formControlName="password"
					autocomplete="current-password"
					required
					aria-required="true"
					[attr.aria-invalid]="
						loginForm.get('password')?.invalid &&
						loginForm.get('password')?.touched
					"
				/>
				@if (passwordError()) {
				<mat-error>
					{{ passwordError() }}
				</mat-error>
				}
			</mat-form-field>

			<div class="form-options" data-testid="form-options">
				<mat-checkbox
					data-testid="remember-me"
					formControlName="rememberMe"
					aria-describedby="rememberMe-hint">
					Stay signed in
				</mat-checkbox>
				<a routerLink="/auth/forgot-password"
				   class="forgot-password-link"
				   data-testid="forgot-password">
					Forgot password?
				</a>
			</div>
			<span
				id="rememberMe-hint"
				class="hint-text">
				Your session will last 14 days on this browser
			</span>

			@if (altchaEnabled) {
			<div class="altcha-container">
				<app-altcha-widget
					[challengeUrl]="challengeUrl"
					[hideFooter]="true"
					(verified)="onAltchaVerified($event)">
				</app-altcha-widget>
			</div>
			}

			<button
				mat-stroked-button
				color="primary"
				type="submit"
				class="submit-button"
				[disabled]="!canSubmit()"
				[attr.aria-busy]="isLoading()">
				@if (isLoading()) { Signing in... } @else { Sign In }
			</button>
		</form>
	</div>
</div>
