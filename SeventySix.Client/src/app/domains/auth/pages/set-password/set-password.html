<div class="set-password-container">
	<div class="set-password-card">
		@if (tokenValid()) {
		<h1>Set New Password</h1>
		<p class="subtitle">
			Enter your new password below. Password must be at least 8 characters.
		</p>

		<form
			[formGroup]="setPasswordForm"
			(ngSubmit)="onSubmit()"
			class="set-password-form">
			<mat-form-field appearance="outline">
				<mat-label>New Password</mat-label>
				<input
					matInput
					id="newPassword"
					type="password"
					formControlName="newPassword"
					autocomplete="new-password"
					placeholder="Enter new password"
					aria-required="true"
					[attr.aria-invalid]="
						setPasswordForm.get('newPassword')?.invalid &&
						setPasswordForm.get('newPassword')?.touched
					"
				/>
				<mat-hint>At least 8 characters required</mat-hint>
				@if (newPasswordError()) {
				<mat-error>{{ newPasswordError() }}</mat-error>
				}
			</mat-form-field>

			<mat-form-field appearance="outline">
				<mat-label>Confirm Password</mat-label>
				<input
					matInput
					id="confirmPassword"
					type="password"
					formControlName="confirmPassword"
					autocomplete="new-password"
					placeholder="Confirm new password"
					aria-required="true"
					[attr.aria-invalid]="
						setPasswordForm.get('confirmPassword')?.invalid &&
						setPasswordForm.get('confirmPassword')?.touched
					"
				/>
				@if (confirmPasswordError()) {
				<mat-error>{{ confirmPasswordError() }}</mat-error>
				}
			</mat-form-field>

			<button
				mat-stroked-button
				color="primary"
				type="submit"
				class="submit-button"
				[disabled]="isLoading()"
				[attr.aria-busy]="isLoading()">
				@if (isLoading()) { Setting Password... } @else { Set Password }
			</button>
		</form>
		} @else {
		<div
			role="alert"
			data-testid="invalid-link-section">
			<h1>Invalid Link</h1>
			<p class="error-message">
				This password reset link is invalid or has expired. Please contact your administrator to request a new
				password reset.
			</p>
			<a
				href="/auth/login"
				mat-stroked-button
				class="submit-button">Return to Login</a>
		</div>
		}
	</div>
</div>
