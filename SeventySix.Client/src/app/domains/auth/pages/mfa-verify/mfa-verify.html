<div class="mfa-verify-container">
	<div class="mfa-verify-card">
		@if (showBackupCodeEntry()) {
			<h1>Use Backup Code</h1>
			<p class="subtitle">
				Enter one of your 8-character backup codes
			</p>
		} @else if (isTotpMode()) {
			<h1>Authenticator Code</h1>
			<p class="subtitle">
				Enter the 6-digit code from your authenticator app
			</p>
		} @else {
			<h1>Verify Your Identity</h1>
			<p class="subtitle">
				Enter the 6-digit code sent to {{ maskedEmail() }}
			</p>
		}

		<form
			[formGroup]="mfaForm"
			(ngSubmit)="onVerify()"
			class="mfa-verify-form">
			<mat-form-field appearance="outline" class="code-field">
				<mat-label>
					@if (showBackupCodeEntry()) {
						Backup Code
					} @else {
						Verification Code
					}
				</mat-label>
				<input
					matInput
					id="code"
					type="text"
					[attr.inputmode]="showBackupCodeEntry() ? 'text' : 'numeric'"
					formControlName="code"
					[maxlength]="expectedCodeLength()"
					autocomplete="one-time-code"
					[placeholder]="showBackupCodeEntry() ? 'XXXXXXXX' : '000000'"
					aria-required="true"
					[attr.aria-invalid]="mfaForm.get('code')?.invalid && mfaForm.get('code')?.touched"
				/>
				@if (showBackupCodeEntry()) {
					<mat-hint>Use one of your backup codes</mat-hint>
				} @else if (isTotpMode()) {
					<mat-hint>Open your authenticator app</mat-hint>
				} @else {
					<mat-hint>Check your email for the code</mat-hint>
				}
			</mat-form-field>

			<button
				mat-stroked-button
				color="primary"
				type="submit"
				class="submit-button"
				[disabled]="!canVerify()"
				[attr.aria-busy]="isLoading()">
				@if (isLoading()) { Verifying... } @else { Verify }
			</button>

			<div class="trust-device-section">
				<mat-checkbox
					data-testid="trust-device-checkbox"
					[checked]="trustDevice()"
					(change)="trustDevice.set($event.checked)"
					aria-label="Skip verification on this device for 30 days">
					Don't ask for a code on this device
				</mat-checkbox>
				<span class="hint-text">
					Skip verification for 30 days
				</span>
			</div>
		</form>

		@if (isEmailMode()) {
			<div class="resend-section">
				<p class="resend-text">Didn't receive the code?</p>
				<button
					mat-button
					type="button"
					data-testid="resend-code-button"
					(click)="onResendCode()"
					[disabled]="resendOnCooldown() || isResending()"
					class="resend-button">
					@if (isResending()) {
						Sending...
					} @else if (resendOnCooldown()) {
						Resend in {{ resendCooldownSeconds() }}s
					} @else {
						Resend Code
					}
				</button>
			</div>
		}

		@if (isTotpMode()) {
			<div class="backup-section">
				<p class="backup-text">Can't access your authenticator?</p>
				<button
					mat-button
					type="button"
					data-testid="use-backup-code-button"
					(click)="onUseBackupCode()"
					class="backup-button">
					Use a Backup Code
				</button>
			</div>
		}

		@if (showBackupCodeEntry()) {
			<div class="backup-section">
				<button
					mat-button
					type="button"
					(click)="onCancelBackupCode()"
					class="backup-button">
					Back to Authenticator
				</button>
			</div>
		}

		<div class="back-section">
			<button
				mat-button
				type="button"
				data-testid="back-to-login-button"
				(click)="onBackToLogin()"
				class="back-button">
				Back to Login
			</button>
		</div>
	</div>
</div>
