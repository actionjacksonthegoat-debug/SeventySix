<div class="register-container">
	<div class="register-card">
		@if (!tokenValid()) {
		<div
			class="error-state"
			role="alert">
			<h1>Link Expired</h1>
			<p>
				This registration link is invalid or has expired. Please request a new one to continue.
			</p>
			<a
				routerLink="/auth/register"
				mat-flat-button
				color="primary"
				class="submit-button">
				Request New Link
			</a>
		</div>
		} @else {
		<h1>Complete Registration</h1>
		<p class="description">
			Choose a username and password to complete your account setup.
		</p>

		<form
			[formGroup]="registerForm"
			(ngSubmit)="onSubmit()"
			class="register-form">
			<div class="form-group required">
				<label for="username">Username</label>
				<input
					id="username"
					type="text"
					formControlName="username"
					autocomplete="username"
					placeholder="Choose a username"
					aria-required="true"
					[attr.aria-invalid]="
						registerForm.get('username')?.invalid &&
						registerForm.get('username')?.touched
					"
					aria-describedby="username-hint username-error"
				/>
				<span
					id="username-hint"
					class="hint">
					Letters, numbers, and underscores only
				</span>
				@if (usernameError()) {
				<span
					id="username-error"
					class="error-text">
					{{ usernameError() }}
				</span>
				}
			</div>

			<div class="form-group required">
				<label for="password">Password</label>
				<input
					id="password"
					type="password"
					formControlName="password"
					autocomplete="new-password"
					placeholder="Create a password"
					aria-required="true"
					[attr.aria-invalid]="
						registerForm.get('password')?.invalid &&
						registerForm.get('password')?.touched
					"
					aria-describedby="password-hint password-error"
				/>
				<span
					id="password-hint"
					class="hint">
					At least 8 characters with uppercase, lowercase, digit, and special character
				</span>
				@if (passwordError()) {
				<span
					id="password-error"
					class="error-text">
					{{ passwordError() }}
				</span>
				}
			</div>

			<div class="form-group required">
				<label for="confirmPassword">Confirm Password</label>
				<input
					id="confirmPassword"
					type="password"
					formControlName="confirmPassword"
					autocomplete="new-password"
					placeholder="Confirm your password"
					aria-required="true"
					[attr.aria-invalid]="
						registerForm.get('confirmPassword')?.invalid &&
						registerForm.get('confirmPassword')?.touched
					"
					aria-describedby="confirmPassword-error"
				/>
				@if (confirmPasswordError()) {
				<span
					id="confirmPassword-error"
					class="error-text">
					{{ confirmPasswordError() }}
				</span>
				}
			</div>

			@if (altchaEnabled) {
			<div class="form-group">
				<app-altcha-widget
					[challengeUrl]="challengeUrl"
					[hideFooter]="true"
					(verified)="onAltchaVerified($event)">
				</app-altcha-widget>
			</div>
			}

			<button
				mat-flat-button
				color="primary"
				type="submit"
				class="submit-button"
				[disabled]="!canSubmit()"
				[attr.aria-busy]="isLoading()">
				@if (isLoading()) { Creating Account... } @else { Create Account }
			</button>
		</form>

		<div class="links">
			<span>Already have an account?</span>
			<a routerLink="/auth/login">Sign In</a>
		</div>
		}
	</div>
</div>
