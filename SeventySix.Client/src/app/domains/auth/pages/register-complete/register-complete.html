<div class="register-container">
	<div class="register-card">
		@if (!tokenValid()) {
		<div
			class="error-state"
			role="alert">
			<h1>Link Expired</h1>
			<p>
				This registration link is invalid or has expired. Please request a new one to continue.
			</p>
			<a
				routerLink="/auth/register"
				mat-stroked-button
				color="primary"
				class="submit-button">
				Request New Link
			</a>
		</div>
		} @else {
		<h1>Complete Registration</h1>
		<p class="description">
			Choose a username and password to complete your account setup.
		</p>

		<form
			[formGroup]="registerForm"
			(ngSubmit)="onSubmit()"
			class="register-form">
			<mat-form-field appearance="outline">
				<mat-label>Username</mat-label>
				<input
					matInput
					id="username"
					data-testid="register-complete-username"
					type="text"
					formControlName="username"
					autocomplete="username"
					placeholder="Choose a username"
					aria-required="true"
					[attr.aria-invalid]="
						registerForm.get('username')?.invalid &&
						registerForm.get('username')?.touched
					"
				/>
				<mat-hint>Letters, numbers, and underscores only</mat-hint>
				@if (usernameError()) {
				<mat-error>{{ usernameError() }}</mat-error>
				}
			</mat-form-field>

			<mat-form-field appearance="outline">
				<mat-label>Password</mat-label>
				<input
					matInput
					id="password"
					data-testid="register-complete-password"
					type="password"
					formControlName="password"
					autocomplete="new-password"
					placeholder="Create a password"
					aria-required="true"
					[attr.aria-invalid]="
						registerForm.get('password')?.invalid &&
						registerForm.get('password')?.touched
					"
				/>
				<mat-hint>At least 8 characters with uppercase, lowercase, digit, and special character</mat-hint>
				@if (passwordError()) {
				<mat-error>{{ passwordError() }}</mat-error>
				}
			</mat-form-field>

			<mat-form-field appearance="outline">
				<mat-label>Confirm Password</mat-label>
				<input
					matInput
					id="confirmPassword"
					data-testid="register-complete-confirm-password"
					type="password"
					formControlName="confirmPassword"
					autocomplete="new-password"
					placeholder="Confirm your password"
					aria-required="true"
					[attr.aria-invalid]="
						registerForm.get('confirmPassword')?.invalid &&
						registerForm.get('confirmPassword')?.touched
					"
				/>
				@if (confirmPasswordError()) {
				<mat-error>{{ confirmPasswordError() }}</mat-error>
				}
			</mat-form-field>

			<button
				mat-stroked-button
				color="primary"
				type="submit"
				class="submit-button"
				data-testid="register-complete-submit"
				[disabled]="!canSubmit()"
				[attr.aria-busy]="isLoading()">
				@if (isLoading()) { Creating Account... } @else { Create Account }
			</button>
		</form>

		<div class="links">
			<span>Already have an account?</span>
			<a routerLink="/auth/login">Sign In</a>
		</div>
		}
	</div>
</div>
