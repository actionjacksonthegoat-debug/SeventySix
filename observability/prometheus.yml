# Prometheus Configuration for SeventySix
# Collects metrics from API and monitors Jaeger

global:
    scrape_interval: 15s
    evaluation_interval: 15s
    external_labels:
        cluster: "seventysix"
        environment: "development"

# Scrape configurations
scrape_configs:
    # SeventySix API metrics
    # Development: Uses HTTP for simplicity with Docker networking
    # Production: Should use HTTPS with proper certificates
    - job_name: "seventysix-api"
      static_configs:
          # When API runs in Docker: use service name on HTTP port
          # The SmartHttpsRedirectionMiddleware allows /metrics over HTTP when configured
          - targets: ["seventysix-api:8080"]
            labels:
                environment: "docker"
          # When API runs locally: use host.docker.internal
          - targets: ["host.docker.internal:5085"]
            labels:
                environment: "local"
      metrics_path: "/metrics"
      scrape_interval: 10s
      # For production with HTTPS enforcement, uncomment and configure:
      # scheme: https
      # tls_config:
      #   insecure_skip_verify: true  # Only for development/self-signed certs

    # Prometheus self-monitoring
    - job_name: "prometheus"
      static_configs:
          - targets: ["localhost:9090"]

    # Jaeger metrics
    - job_name: "jaeger"
      static_configs:
          - targets: ["jaeger:14269"]

    # Redis/Valkey metrics via redis-exporter
    # Provides cache hit rate, memory usage, operations/sec, connected clients
    - job_name: "redis"
      static_configs:
          - targets: ["redis-exporter:9121"]
      scrape_interval: 5s
